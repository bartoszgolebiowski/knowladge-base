# EC2

## **EC2 Instance Types and Families**

- Different instance families are optimized for specific workloads.
- Naming convention: `family.size.generation.optional_enhancements` (e.g., `r5.2xlarge`).

| **Family** | **Description** | **Use Cases** | **Example** |
| --- | --- | --- | --- |
| **R** | Memory Optimized | In-memory databases, data analytics, high-performance databases | `r5.large`, `r6g.xlarge` |
| **C** | Compute Optimized | CPU-intensive applications, high-performance computing, databases | `c5.xlarge`, `c7g.medium` |
| **M** | General Purpose | Web servers, application servers, small to medium databases | `m5.large`, `m6i.large` |
| **I** | High I/O (Instance Store Optimized) | High-performance NoSQL databases (with local NVMe SSDs) | `i3.xlarge`, `i4i.large` |
| **G** | Graphics Processing Unit (GPU) | Machine learning, video rendering, graphics-intensive applications | `g4dn.xlarge`, `g5.xlarge` |
| **T (e.g., T2, T3)** | Burstable Performance | Low to moderate CPU utilization with occasional bursts (web servers, development/test) | `t3.micro`, `t4g.small` |
| **T2/T3 Unlimited** | Sustained High Performance (Burstable) | Workloads needing sustained high CPU performance for extended periods | `t3.unlimited` |
- **ec2instances.info**: A valuable website for comparing EC2 instance specifications and pricing.

## **EC2 Instance Placement**

- Controls where your EC2 instances are physically located within AWS data centers.

### **Placement Group Strategies**

| **Strategy** | **Description** | **Benefits** | **Drawbacks** | **Use Cases** | **Max Instances** |
| --- | --- | --- | --- | --- | --- |
| **Cluster** | Instances are placed in close proximity within a single Availability Zone (AZ). | Low latency, high network throughput between instances (10 Gbps). | Single point of failure within the rack. | High-performance computing (HPC), big data processing, low-latency apps | - |
| **Spread** | Instances are placed on distinct underlying hardware across different AZs. | Reduced risk of simultaneous hardware failures, high availability. | Limited to 7 instances per group per AZ. | Critical applications, maximizing high availability, isolated failures | 7 per AZ |
| **Partition** | Instances are spread across multiple partitions within one or more AZs. | Hardware isolation between partitions, failure in one partition doesn't affect others, hundreds of instances per group. | Potential for uneven distribution across partitions. | Hadoop, Cassandra, Kafka, large distributed systems | Hundreds |

### **Moving Instances In/Out of Placement Groups**

1. **Stop** the EC2 instance.
2. Use the **AWS CLI** to modify the instance placement attribute.
3. **Start** the instance.

## **Cluster Placement Group Deep Dive**

- Instances on the same rack within the same AZ.
- **Benefit**: High network bandwidth (10 Gbps), low latency.
- **Risk**: All instances can fail simultaneously if the underlying rack fails.
- **Enhanced Networking**: Choose instance types with enhanced networking capabilities for optimal performance within a cluster placement group.
- **Use Cases**:
    - Big data jobs requiring fast completion.
    - High-performance computing.
    - Applications needing extremely low latency and high network throughput.

## **Spread Placement Group Deep Dive**

- Instances on different physical hardware, potentially across multiple AZs (up to 7 per AZ per group).
- **Pros**:
    - Spanning across multiple AZs for higher availability.
    - Very low risk of simultaneous hardware failure.
    - EC2 instances on distinct physical hardware.
- **Cons**:
    - Limited to a maximum of 7 instances per AZ per placement group, limiting scale.
- **Use Cases**:
    - Applications requiring maximum high availability.
    - Critical applications where instance failures must be isolated.

## **Partition Placement Group Deep Dive**

- AZ divided into multiple partitions, with EC2 instances spread across them (up to 7 partitions per AZ).
- Hundreds of EC2 instances can be part of a partition placement group.
- Instances in different partitions do not share racks.
- Failure in one partition affects only the instances within that partition.
- EC2 metadata service allows instances to identify their partition.
- **Use Cases**:
    - HDFS
    - HBase
    - Cassandra
    - Kafka

## **EC2 Instance Purchasing Options**

| **Option** | **Use Case** | **Discount** | **Flexibility** | **Interruption Risk** | **Minimum Commitment** |
| --- | --- | --- | --- | --- | --- |
| **On-Demand** | Short workloads, predictable pricing, reliability. | None | High | None | None |
| **Spot Instances** | Short, fault-tolerant workloads, cost-sensitive. | High | Low | High | None |
| **Reserved Instances (RI)** | Long workloads (1+ year), significant discounts. | High | Moderate | None | 1 year |
| **Convertible RI** | Long workloads, need to change instance types over time. | Medium | High | None | 1 year |
| **Dedicated Instances** | No shared hardware with other AWS customers. | - | High | None | None |
| **Dedicated Hosts** | Entire physical server dedicated to you, control over instance placement, software licensing requirements. | - | High | None | None |
- **Payment Options for RIs**: All Upfront, Partial Upfront, No Upfront (discount decreases with less upfront payment).

## **AWS Graviton Processors**

- Offer better price performance for EC2 instances.
- Supports various Linux distributions (Amazon Linux 2, RedHat, SUSE, Ubuntu, etc.).
- **Not available for Windows instances.**
- **Graviton2**: Up to 40% better price performance than comparable 5th generation x86-based instances.
- **Graviton3**: Up to 3x better performance than Graviton2.
- **Use Cases**: Application servers, microservices, HPC, machine learning, video encoding, gaming, in-memory caches.

## **EC2 Instance Metrics (CloudWatch)**

- **Default Metrics (Provided by AWS):**
    - **CPU Utilization**: Percentage of allocated EC2 compute units.
    - **Network In/Out**: Traffic to and from the instance.
    - **Status Checks**:
        - **Instance Status**: Issues with the EC2 virtual machine.
        - **System Status**: Issues with the underlying hardware.
    - **Disk (Instance Store Only)**: Read/write operations (IOPS and bytes).
    - **Credit Usage/Balance (T2/T3)**: For burstable performance instances.
- **Important Note**: **RAM utilization is NOT included in the default EC2 metrics.** You need to push it as a **custom metric** to CloudWatch using the CloudWatch agent.

## **EC2 Instance Recovery**

- Automated process to recover an instance when the **system status check** fails (indicating an underlying hardware issue).
- Configured using a **CloudWatch Alarm** that monitors the system status check.
- **Action**: `EC2 Instance Recovery`.
- **Preserved Attributes upon Recovery**:
    - Private IP address
    - Public IP address
    - Elastic IP address
    - Metadata
    - Placement group
- **Notification**: The CloudWatch Alarm can also trigger an **SNS topic** to notify users (e.g., via Slack).
- **Focus on System Status Check**: Instance recovery is primarily triggered by failures at the underlying hardware level.