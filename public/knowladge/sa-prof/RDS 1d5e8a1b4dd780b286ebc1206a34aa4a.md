# RDS

# **AWS Solution Architect Professional - Amazon RDS Notes**

## **Core Concepts**

- **Managed Relational Database Service:** AWS manages the underlying infrastructure, including backups, patching, and monitoring.
- **Database Engines:** Supports several popular relational database engines:
    - PostgreSQL
    - MySQL
    - MariaDB
    - IBM Db2
    - Oracle
    - Microsoft SQL Server
- **Provisioned Infrastructure:** Unlike serverless databases, you need to provision the server instance type and size.
- **VPC Integration:** RDS databases are typically launched within a private subnet of a Virtual Private Cloud (VPC).
- **Security:** Access control is managed through Security Groups. Lambda functions accessing RDS in a VPC must also be launched within a private subnet.
- **Storage:** Utilizes EBS volumes, with the option for automatic storage scaling.
- **Backups:**
    - **Automated Backups:** Enabled by default with point-in-time recovery. Backups have a defined retention period.
    - **Manual Snapshots:** User-initiated backups that can be retained indefinitely. Snapshots can be copied across AWS regions for disaster recovery purposes.
- **RDS Event Notifications:** Publishes events related to the database (operations, outages, backups, etc.) to an SNS topic.

## **High Availability and Read Scaling**

- **Multi-AZ:**
    - Provides a synchronous standby instance in a different Availability Zone (AZ) for automatic failover in case of an outage.
    - Application connects to a single DNS name, which automatically switches to the standby instance upon failure.
    - The standby instance is **not** used for read operations; all reads and writes go to the primary (master) instance.
- **Read Replicas:**
    - Asynchronous read-only copies of the primary database instance.
    - Can be created within the same region or across different regions.
    - Used to offload read traffic from the primary instance, improving performance and scalability for read-heavy workloads.
    - Provide eventual consistency due to asynchronous replication.
- **Read Replica Distribution with Route 53:**
    - Route 53 can be used to distribute read traffic across multiple read replicas.
    - **Weighted Record Sets:** Allow assigning weights to each read replica endpoint to control the distribution of traffic.
    - **Health Checks:** Route 53 can perform health checks on read replicas (e.g., linked to CloudWatch alarms) and exclude unhealthy instances from the DNS records.

## **Security Features**

- **KMS Encryption:** Enables encryption at rest for the underlying EBS volumes and snapshots.
- **Transparent Data Encryption (TDE):** Supported for Oracle and SQL Server to encrypt data before it's written to storage.
- **SSL Encryption:** Used to encrypt in-transit connections to the RDS database. Can be enforced for enhanced security.
- **IAM Authentication:** Supported for MySQL, PostgreSQL, and MariaDB.
    - Allows authentication using IAM roles and policies instead of database-native passwords.
    - Authentication token obtained via RDS API calls has a limited lifespan (15 minutes) but is only needed for the initial connection.
    - Authorization (permissions within the database) is still managed within RDS.
- **Encrypted Snapshots:** You can create an encrypted snapshot from an unencrypted one, allowing you to encrypt an existing unencrypted database through the snapshot and restore process.
- **CloudTrail:** Does **not** track queries executed within the RDS database.

## **RDS for Oracle Specifics**

- **Backup Methods:**
    - **RDS Backups:** Used for backing up and restoring Amazon RDS for Oracle instances. Restores can only be done to another RDS for Oracle instance.
    - **Oracle Recovery Manager (RMAN):** Can back up an RDS for Oracle instance, but restores using RMAN can only be performed to external (non-RDS) Oracle databases.
- **Real Application Clusters (RAC):** **Not supported** on Amazon RDS for Oracle. RAC requires full control over the Oracle installation, which is only available on EC2 instances.
- **Transparent Data Encryption (TDE):** Supported for encrypting data at rest.
- **AWS Database Migration Service (DMS):** Can be used to migrate or replicate data from on-premises Oracle databases to Amazon RDS for Oracle.

## **RDS for MySQL Specifics**

- **`mysqldump` Tool:** The native `mysqldump` utility can be used to migrate data from an RDS for MySQL instance to a non-RDS MySQL database (on-premises or on EC2). This process typically involves exporting data, transferring it, and importing it into the target database, potentially followed by setting up replication for minimal downtime migration.

## **RDS Proxy for AWS Lambda**

- **Problem:** Lambda functions can experience "TooManyConnections" errors when concurrently accessing RDS databases due to the overhead of establishing and managing database connections.
- **Solution:** RDS Proxy acts as a connection pooler between Lambda functions and RDS databases (including Aurora).
- **Benefits:**
    - Eliminates the need for connection pooling logic in Lambda functions.
    - Manages idle connections efficiently.
    - Supports IAM and database authentication.
    - Auto-scales to handle varying Lambda concurrency.
- **Connectivity:** Lambda functions need network connectivity to the RDS Proxy (either public-public or private-private).

## **Cross-Region Failover Architecture (General RDS)**

- **Mechanism:**
    1. Monitor the health of the primary RDS database in the primary region using health checks (e.g., via a dedicated health check endpoint or CloudWatch alarms).
    2. Route 53 health checks monitor the health of the primary database.
    3. A CloudWatch alarm triggers a CloudWatch Event upon failure.
    4. A Lambda function is triggered by the CloudWatch Event.
    5. The Lambda function performs the following actions:
        - Updates the Route 53 DNS record to point to the standby database in the secondary region.
        - Promotes a cross-region read replica in the secondary region to become the new primary database.
- **Prerequisites:** Cross-region read replication must be configured.

**Key takeaway for the exam:** Understand the different RDS engines, Multi-AZ for high availability, Read Replicas for read scaling, security features like IAM authentication and encryption, and the use cases and benefits of RDS Proxy. Be familiar with the specific considerations for Oracle and MySQL, and the common architecture for cross-region failover.