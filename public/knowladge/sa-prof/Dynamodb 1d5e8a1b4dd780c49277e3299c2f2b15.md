# Dynamodb

# **AWS Solution Architect Professional - DynamoDB Notes**

## **Core Concepts**

- **NoSQL Database:** Fully managed, serverless, providing massive scalability (up to 1 million requests per second).
- **Architecture:** Similar to Apache Cassandra, facilitating potential migrations.
- **Management:** No disk space provisioning required.
- **Object Size Limit:** Maximum object size is 400 KB.
    - Larger objects can be stored in Amazon S3 with a reference in DynamoDB.
- **Capacity Modes:**
    - **Provisioned Capacity:** Specify Read Capacity Units (RCUs) and Write Capacity Units (WCUs). Offers smoother scaling and potentially better cost. Auto-scaling can be enabled.
    - **On-Demand:** Pay per read and write request. Suitable for unpredictable workloads and development environments.
- **Operations:** Supports CRUDE (Create, Read, Update, Delete) operations.
- **Read Consistency:** Supports both eventually consistent and strongly consistent reads.
- **Transactions:** Supports ACID (Atomicity, Consistency, Isolation, Durability) transactions across multiple tables.
- **Data Protection:** Backups and Point-in-Time Recovery (PITR) are available.
- **Table Classes:**
    - **Standard:** For frequently accessed data.
    - **Infrequent Access:** For less frequently accessed data, offering cost savings.

## **Tables, Items, and Attributes**

- **Tables:** The fundamental unit in DynamoDB.
- **Primary Keys:** Must be defined at table creation. Crucial for uniqueness and data distribution.
- **Items:** Equivalent to rows, with no fixed schema.
- **Attributes:** Equivalent to columns, can be added over time and can be null.
- **Item Size Limit:** Maximum item size is 400 KB.
- **Data Types:**
    - **Scalar:** String, Number, Binary, Boolean, Null.
    - **Document:** List, Map.
    - **Set:** String Set, Number Set, Binary Set.

## **Primary Key Options**

- **Partition Key (Hash Key):**
    - Must be unique for each item.
    - Data is distributed based on the partition key value.
    - Example: `user_id` in a users table.
- **Composite Primary Key (Partition Key + Sort Key / Range Key):**
    - Only the combination of the partition key and sort key must be unique.
    - Data is grouped logically by the partition key.
    - Sort key is often used for range queries or to maintain order within a partition.
    - Examples:
        - `user_id` (partition key) and `game_id` (sort key) in a users-games table.
        - `user_id` (partition key) and `timestamp` (sort key) for tracking events over time.

## **Indexes**

- **Querying:** DynamoDB primarily allows querying by the primary key (partition key and optionally the sort key).
- **Local Secondary Index (LSI):**
    - Uses the same partition key as the base table.
    - Allows defining an alternative sort key for efficient queries on different attributes within the same partition.
    - **Must be defined at table creation.**
- **Global Secondary Index (GSI):**
    - Allows defining a new partition key and an optional sort key, different from the base table's primary key.
    - Enables querying data based on attributes other than the primary key.
    - **Can be defined after table creation.**
- **Importance:** Indexes are essential for querying data efficiently based on specific attributes. Unlike traditional RDBMS, you need to plan your queries and create appropriate indexes.

## **Important Features**

- **Time To Live (TTL):** Allows defining an expiration time for items, after which they are automatically deleted.
- **DynamoDB Streams:**
    - Capture item-level changes (Create, Update, Delete) in near real-time.
    - Can be consumed by services like AWS Lambda or EC2 for real-time processing.
    - Data retention of 24 hours.
    - **Common Architecture:** DynamoDB table -> DynamoDB Stream -> Lambda -> Other AWS services (e.g., OpenSearch, Kinesis).
- **Global Tables:**
    - Provide multi-region, active-active replication of DynamoDB tables.
    - Requires enabling DynamoDB Streams first.
    - Useful for low-latency global access and disaster recovery with low RTO.
- **Kinesis Data Streams with DynamoDB Streams:**
    - Allows sending DynamoDB stream data to a Kinesis data stream.
    - **Benefits:** Longer data retention (up to 365 days) compared to DynamoDB Streams and integration with Kinesis analytics tools.
    - **Workflow:** DynamoDB Table -> DynamoDB Stream -> Kinesis Data Stream -> Kinesis Data Firehose (to S3, Redshift, OpenSearch) or Kinesis Data Analytics.

## **Solution Architecture Example: S3 Metadata Search**

- **Problem:** Amazon S3 lacks built-in indexing for efficient object searching based on metadata.
- **Solution:**
    1. Write/Update objects in an S3 bucket.
    2. S3 event triggers an AWS Lambda function.
    3. Lambda function extracts object metadata.
    4. Lambda function inserts metadata into a DynamoDB table.
    5. Create LSIs and GSIs on the DynamoDB table to enable efficient searching of metadata.
- **Benefits:** Enables querying S3 objects based on various attributes (e.g., date, customer, specific properties), which is not possible with S3 alone.

## **Caching with DynamoDB**

- **DynamoDB Accelerator (DAX):**
    - Seamless, in-memory cache for DynamoDB.
    - Requires no application code changes for basic integration.
    - Provides microsecond latency for cached reads and queries.
    - Solves the "Hot Key" problem by caching frequently accessed items.
    - Default cache TTL is 5 minutes.
    - Supports up to 10 nodes per cluster, multi-AZ deployment recommended (minimum 3 nodes for production).
    - Secure with encryption at rest (KMS), VPC integration, IAM, CloudTrail.
- **DAX vs. ElastiCache for DynamoDB:**
    - **DAX:** Primarily for caching individual DynamoDB items and query/scan results directly in front of DynamoDB.
    - **ElastiCache:** More general-purpose caching service. Can be used to cache results of heavy computations performed after retrieving data from DynamoDB or even act as a standalone cache.
    - **Architectural Considerations:**
        - For direct client access and caching of DynamoDB data, DAX is the preferred choice.
        - If clients perform significant post-processing of data retrieved from DynamoDB, ElastiCache can be used to cache the results of these computations.
        - A DynamoDB table itself could theoretically act as a cache, but DAX and ElastiCache offer dedicated caching features.

**Key takeaway for the exam:** Understand the core concepts, primary key options, the difference and use cases of LSIs and GSIs, and the purpose and architectural considerations of DAX for caching DynamoDB.