# Redshift

# **Amazon Redshift - Data Warehousing**

## **Purpose and Goals**

- Online Analytical Processing (OLAP) for analytics and data warehousing.
- Designed for high performance and scalability to petabytes of data.

## **Core Concepts**

- **Based on PostgreSQL (but not for OLTP):** While based on PostgreSQL, Redshift is optimized for analytical workloads (OLAP) rather than transactional workloads (OLTP). Amazon RDS is better suited for OLTP.
- **Columnar Storage:** Data is stored in columns rather than rows. This is highly efficient for analytical queries that often involve aggregations (SUM, AVG) on specific columns.
- **Massively Parallel Processing (MPP):** Queries are distributed and executed in parallel across multiple Redshift nodes for optimal performance.
- **Deployment Modes:**
    - **Provisioned Cluster:** On-demand servers provisioned and managed by the user.
    - **Serverless Cluster:** AWS manages the underlying infrastructure, providing a SQL interface for querying.

## **Integration and Usage**

- **SQL Interface:** Standard SQL interface allows integration with various business intelligence (BI) tools.
- **BI Tool Integration:** Works seamlessly with tools like AWS QuickSight and Tableau for dashboard creation and visualization.
- **Data Loading:**
    - **Amazon S3 (COPY command):** Efficiently load large datasets from S3.
    - **Kinesis Data Firehose:** Near real-time data ingestion into Redshift.
    - **DynamoDB:** Integration for loading data from NoSQL databases.
    - **AWS DMS (Database Migration Service):** Migrate data from various source databases.

## **Cluster Characteristics**

- **Scalability:** Can scale to hundreds of compute nodes (100+).
- **Node Storage:** Each node can have significant storage capacity (e.g., up to 16 TB), allowing for massive data warehouses.
- **Availability Zone (AZ) Support:**
    - **Single AZ:** Most cluster types offer single AZ deployment.
    - **Multi AZ (for some cluster types):** Provides failover capabilities for disaster recovery within a region.

## **Node Types**

- **Leader Node:**
    - Handles query planning.
    - Aggregates results from compute nodes.
- **Compute Nodes:**
    - Execute the actual queries.
    - Return results to the leader node.

## **Management and Security**

- **Managed Service:** AWS handles backups and restores.
- **VPC Integration:** Launched within a Virtual Private Cloud (VPC) for network isolation.
- **Security:**
    - **IAM Security:** Controls access to the Redshift cluster.
    - **KMS Encryption:** Encrypts data at rest.
    - **CloudWatch Monitoring:** Provides metrics and logs for performance monitoring.
- **Redshift Enhanced VPC Routing:** Forces COPY and UNLOAD traffic through the VPC for enhanced security and performance.

## **Cost Considerations**

- **Sustained Usage:** Redshift is most cost-effective for environments with consistent query activity.
- **Sporadic Queries:** For infrequent querying, Amazon Athena (serverless query service for S3) might be a better choice.

## **Snapshots and Disaster Recovery**

- **Snapshots:** Point-in-time backups of the cluster stored in Amazon S3.
    - **Incremental:** Only saves the changes since the last snapshot.
    - **Restore to New Cluster:** Snapshots can only be restored to a newly created Redshift cluster.
- **Snapshot Types:**
    - **Automated Snapshots:** Taken every eight hours or after every 5 GB of data change, or based on a user-defined schedule. Retention period is configurable (e.g., 30 days), after which they are automatically deleted.
    - **Manual Snapshots:** User-initiated snapshots retained until explicitly deleted.
- **Cross-Region Snapshot Copy:** Redshift can automatically copy snapshots (automated or manual) to another AWS region for disaster recovery.
- **Cross-Region Copy with KMS Encryption:**
    - Requires a **Redshift Snapshot Copy Grant** in the destination region.
    - This grant allows Redshift service to perform encryption operations in the destination region using the destination KMS key.
    - Enables copying KMS-encrypted snapshots from a source region (encrypted with KMS key A) to a destination region (encrypted with KMS key B).

## **Redshift Spectrum**

- **Querying Data in S3:** Allows querying data directly in Amazon S3 without loading it into Redshift first.
- **Redshift Cluster Requirement:** Requires an existing Redshift cluster to initiate the queries.
- **Spectrum Nodes:** Queries are processed by thousands of virtual Redshift Spectrum nodes.
- **Workflow:**
    1. Redshift cluster (leader and compute nodes) receives a query involving S3 data.
    2. Redshift spins up virtual Spectrum nodes.
    3. Spectrum nodes process and query the data in S3.
    4. Results are returned to the Redshift compute nodes for aggregation.
    5. Final results are sent back to the leader node.

## **Redshift Workload Management (WLM)**

- **Query Prioritization:** Enables flexible management of query priorities within workloads.
- **Use Case:** Prevents short, fast queries from being blocked by long-running queries.
- **Query Queues:** Allows defining multiple query queues (e.g., super user, short running, long running).
- **Query Routing:** Queries are routed to the appropriate queue at runtime based on user or query type.
- **WLM Modes:**
    - **Automatic WLM:** Queues and resources are managed by Redshift.
    - **Manual WLM:** Queues and resource allocation are configured by the user.

## **Redshift Concurrency Scaling**

- **Consistent Fast Performance:** Provides consistently fast query performance for a virtually unlimited number of concurrent users and queries.
- **On-the-Fly Capacity:** Automatically adds Redshift capacity (concurrency scaling clusters) to handle increased query load.
- **Concurrency Scaling Cluster:** Additional, temporary cluster capacity for processing increased requests.
- **WLM Integration:** WLM can be used to direct specific queries to the concurrency scaling cluster.
- **Pricing:** Charged per second of usage for the concurrency scaling cluster.

## **Key Takeaways for the Exam**

- Understand the fundamental differences between OLTP (RDS) and OLAP (Redshift).
- Know the benefits of columnar storage for analytical workloads.
- Be familiar with the different deployment modes (provisioned vs. serverless).
- Understand how data is loaded into Redshift from various sources (S3, Kinesis, DynamoDB, DMS).
- Know the characteristics of Redshift clusters (scalability, node types, AZ support).
- Understand the importance of snapshots (automated and manual) for backup and recovery.
- Be able to explain cross-region snapshot copy and the requirement for a snapshot copy grant for KMS-encrypted snapshots.
- Understand how Redshift Spectrum enables querying data in S3 without loading.
- Know the purpose and benefits of Redshift Workload Management (WLM) for query prioritization.
- Understand how Redshift Concurrency Scaling provides consistent performance under high query loads.