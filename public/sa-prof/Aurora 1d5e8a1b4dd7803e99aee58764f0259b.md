# Aurora

# **AWS Solution Architect Professional - Amazon Aurora Notes**

## **Core Concepts**

- **MySQL and PostgreSQL Compatibility:** Aurora offers compatibility with MySQL and PostgreSQL, making it easy to migrate existing applications.
- **Automatic Storage Scaling:** Storage automatically scales in increments of 10 GB, up to 128 TB per database instance. You don't need to manage storage provisioning.
- **High Availability:** Six copies of your data are maintained across three Availability Zones (AZs) by default, ensuring high durability and availability.
- **Multi-AZ by Default:** Aurora's architecture inherently provides multi-AZ resilience.
- **Read Replicas:** You can create up to 15 Aurora Read Replicas per primary instance.
- **Reader Endpoint:** A single endpoint that provides load balancing across all available Aurora Read Replicas.
- **Cross-Region Read Replicas:** Allows creating read replicas in different AWS regions for disaster recovery or low-latency reads in geographically distributed applications. Note that **the entire database** is replicated, not individual tables.
- **Direct S3 Integration:** Enables loading data directly from S3 into Aurora and exporting data directly from Aurora to S3, bypassing the need for client-side processing and reducing network costs.
- **Backups, Snapshots, and Restore:** Functions similarly to standard RDS, offering automated backups with point-in-time recovery and manual snapshots.

## **Architectural Deep Dive**

- **Shared Storage:** Aurora utilizes a shared storage layer that provides replication, self-healing, and auto-expansion.
- **Data Replication:** Data is replicated across six storage nodes in three different AZs.
- **Write Quorum:** Four out of the six data copies need to acknowledge a write operation for it to be considered successful.
- **Read Quorum:** Three out of the six data copies are needed to serve a read request.
- **Self-Healing:** The underlying storage layer has peer-to-peer replication and self-healing capabilities managed by AWS.
- **Striped Storage:** Database storage is striped across hundreds of volumes, eliminating single points of failure.
- **Master Instance Failover:** Failover of the primary (master) instance typically occurs in less than 30 seconds.
- **Read/Write Separation:** The master instance handles all write operations, while both the master and up to 15 read replicas can serve read traffic.
- **Cross-Region DR:** Promoting a cross-region read replica can serve as a disaster recovery strategy in case of a regional outage.

## **Aurora Endpoints**

- **Endpoint Definition:** A combination of a host address and a port used to connect to an Aurora cluster.
- **Cluster Endpoint (Writer Endpoint):**
    - Points to the primary DB instance (master) in the Aurora cluster.
    - Used for all write operations (INSERT, UPDATE, DELETE) and potentially some read queries.
- **Reader Endpoint:**
    - Provides load balancing for read-only connections across all available Aurora Read Replicas in the cluster.
    - Should be used for read operations (SELECT queries).
- **Custom Endpoints:**
    - Allow defining specific subsets of DB instances within the Aurora cluster based on criteria you specify (e.g., instance type, configuration).
    - Useful for directing specific types of workloads (e.g., analytical queries) to a dedicated set of replicas with appropriate resources.
    - Once custom endpoints are defined for all read replicas, the general reader endpoint might not be the primary connection method for read traffic.
- **Instance Endpoint:**
    - Provides a direct connection to a specific DB instance within the Aurora cluster.
    - Used for diagnostic purposes or fine-tuning a particular instance.

## **Aurora Logs**

- **Available Logs:**
    - Error Logs
    - Slow Query Logs
    - General Log
    - Audit Log
- **Log Management:**
    - Log files are generated within Aurora.
    - Can be downloaded for offline analysis.
    - Can be published to Amazon CloudWatch Logs for centralized monitoring and analysis.

## **Troubleshooting Aurora and RDS Performance**

- **Performance Insights:**
    - A powerful tool to visualize database load and identify performance bottlenecks.
    - Provides insights into:
        - **Waits:** Time spent on different database activities (compute, I/O, network).
        - **SQL Statements:** Real-time view of the most resource-intensive queries.
        - **Hosts:** Identifies which client servers are generating the most load.
        - **Users:** Shows which database users are consuming the most resources.
- **CloudWatch Metrics:**
    - Provides basic operating system-level metrics:
        - CPU Utilization
        - Memory Usage
        - Swap Memory Usage
- **Enhanced Monitoring:**
    - Offers more granular, per-second metrics and host-level information.
    - Includes details like the top 100 processes running on the database instance.
    - Useful for deep-dive analysis of instance-level performance issues.
- **Slow Query Logs:**
    - Records queries that take longer than a specified threshold.
    - Essential for identifying poorly performing queries that need optimization.

**Key takeaway for the exam:** Understand the core benefits of Aurora (scalability, availability, performance), the differences between Aurora and standard RDS, the significance of the shared storage architecture, the different types of Aurora endpoints and their use cases, and the tools available for monitoring and troubleshooting Aurora performance. Be prepared to compare Aurora with other database options like DynamoDB based on specific architectural requirements.