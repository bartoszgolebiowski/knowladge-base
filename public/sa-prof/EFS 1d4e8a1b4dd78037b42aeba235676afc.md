# EFS

**AWS Elastic File System (EFS) - Summary Notes**

## **Core Concepts**

- **Managed Network File System (NFS):** Provides scalable file storage for use with EC2 instances and on-premises servers.
- **Mountable on Multiple EC2 Instances:** Allows concurrent access from numerous EC2 instances within the same region across different Availability Zones (AZs).
- **On-premises Access:** Can be mounted on on-premises servers after establishing a connection to AWS via Direct Connect or VPN.
- **High Availability and Scalability:** Designed for high availability and automatically scales in capacity.
- **Cost Model:** Pay-per-gigabyte used, which can be more cost-effective than EBS for fluctuating storage needs.
- **Security:** Secured via security groups attached to the EFS file system. EC2 instances need appropriate security group rules to access it.
- **Linux Requirement:** Requires a Linux-based Amazon Machine Image (AMI). **Windows is not supported.**
- **POSIX Compliance:** The underlying file system must be POSIX-compliant.
- **NFSv4.1 Protocol:** Utilizes the NFSv4.1 protocol.
- **Encryption:** Supports encryption at rest using AWS KMS.
- **Single VPC Attachment (Initially):** An EFS file system is created within a single VPC. However, access from peered VPCs or on-premises is possible.
- **Mount Targets and ENIs:** One mount target (with an Elastic Network Interface - ENI) is created per AZ.

## **Use Cases**

- Content Management
- Web Data Serving
- Data Sharing
- WordPress

## **Performance and Storage Classes**

### **Performance Modes (Set at Creation)**

- **General Purpose (Default):** Low latency for latency-sensitive workloads (e.g., web servers, CMS).
- **Max I/O:** High throughput, higher latency, optimized for parallel processing (e.g., big data, media processing).
- **Throughput Modes:**
    - **Bursting:** Provides a baseline throughput with the ability to burst to higher levels. Throughput scales with storage size.
    - **Provisioned:** Allows specifying a fixed throughput independent of storage size.
    - **Elastic:** Automatically scales throughput up and down based on workload, suitable for unpredictable workloads.

### **Storage Classes**

- **Storage Tiers (Lifecycle Management):**
    - **Standard:** For frequently accessed files.
    - **EFS-IA (Infrequent Access):** Lower storage cost but incurs a retrieval cost.
    - **Archive:** Lowest storage cost for rarely accessed data with higher retrieval latency and cost.
- **Lifecycle Policies:** Automate the movement of files between storage tiers based on access patterns (defined by the number of days since last access).
- **Availability and Durability:**
    - **Standard:** Multi-AZ deployment for high availability and disaster recovery.
    - **One Zone:** Single AZ deployment, lower cost, suitable for development. Compatible with IA tier (One Zone-IA).
- **Cost Savings:** Utilizing the right storage classes can lead to significant cost reductions (up to 90%).

## **Access and Connectivity**

- **On-premises Mounting:** Requires a connection to AWS (Direct Connect or VPN). Mount using the IPv4 address of the ENIs (DNS is not supported).
- **VPC Peering:** EC2 instances in peered VPCs can access EFS file systems.
- **Redundancy:** Can be implemented for on-premises connections (e.g., Direct Connect to Direct Connect, Direct Connect to VPN).

## **EFS Access Points**

- **Simplified Application Access Management:** Facilitates managing application access to NFS environments with enhanced security.
- **POSIX User and Group Enforcement:** Allows defining a user and group on the POSIX file system for access.
- **Directory-Level Access Control:** Restricts access to specific directories within the file system.
- **Optional Root Directory:** Allows specifying a different root directory for the access point.
- **IAM Policy Integration:** Access to access points can be controlled using IAM policies.

## **File System Policies**

- **Resource-Based Policies:** Similar to S3 bucket policies.
- **Default Full Access:** By default, all clients have full access.
- **Granular Permissions:** Allows defining specific actions (e.g., mount, write) and conditions (e.g., requiring secure transport) for specific principals.

## **Cross-Region Replication**

- **Disaster Recovery and Compliance:** Replicates data from an EFS file system in one AWS region to another.
- **Existing and New File Systems:** Can be enabled for both new and existing file systems.
- **RPO and RTO in Minutes:** Provides low Recovery Point Objective (RPO) and Recovery Time Objective (RTO).
- **No Impact on Provisioned Throughput:** Replication occurs in the backend without affecting the EFS file system's provisioned throughput.