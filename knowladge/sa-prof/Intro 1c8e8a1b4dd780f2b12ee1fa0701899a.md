# Intro

# AWS IAM Deep Dive

## IAM Basics Reminder

- **Users:** Long-term credentials for AWS access.
- **Groups:** Collections of users for easier permission management.
- **Roles:** Short-term credentials obtained via STS (Security Token Service).
    - Used for temporary permissions.
    - EC2 instance roles: Leverage EC2 metadata service for credentials.
    - Service roles: Permissions granted to AWS services (e.g., API Gateway, CodeDeploy).
    - Cross-account roles: Securely access resources in other AWS accounts.

## IAM Policies

- Define permissions for users and roles.
- Types:
    - **AWS Managed:** Predefined by AWS.
    - **Customer Managed:** Created and managed by you.
    - **Inline Policies:** Directly attached to a single user or role.
    - **Resource Based Policies:** Attached to AWS resources (e.g., S3 bucket policies).
- Structure (JSON Document):
    - **Effect:** Allow or Deny.
    - **Action:** Specific AWS actions.
    - **Resource:** AWS resources the action applies to.
    - **Condition:** Criteria for policy application.
    - **Policy Variables:** Placeholders in policies.
- **Explicit DENY:** Always overrides ALLOW.
- **Least Privilege Principle:** Grant only necessary permissions.

## IAM Tools

- **IAM Access Advisor:** Shows granted permissions and last access time.
- **Access Analyzer:** Identifies external access to resources (e.g., S3 buckets).

## Common IAM Policies

- **AdministratorAccess:** Grants full access to all AWS resources.
- **PowerUserAccess:** Grants access to most AWS services, excluding IAM management.
    - Uses "NotAction" to allow all but certain IAM actions.

## IAM Policy Conditions

- Conditions refine when a policy applies.
- Types:
    - **String Operators:** Comparing string values.
    - **Numeric Operators:** Comparing numeric values.
    - **Date Operators:** Comparing dates.
    - **Boolean Operators:** Evaluating true/false values.
    - **IP Address Operators:** Restricting access by IP address.
    - **Arn Operators:** Comparing Amazon Resource Names.
    - **Null Condition:** Checking for null values.

## IAM Policy Variables and Tags

- Dynamic placeholders in policies.
- Examples:
    - `$${AWS:username}`: User's username.
    - `$${aws:CurrentTime}`: Current time.
    - `$${ec2:SourceInstanceARN}`: EC2 Instance ARN.
    - `$${resource-tag/key-name}`: Resource tag value.
    - `$${principal-tag/key-name}`: Principal tag value.

## IAM Roles vs. Resource-Based Policies

- **IAM Roles:**
    - Principal assumes the role, temporarily losing original permissions.
    - Used for cross-account access.
- **Resource-Based Policies:**
    - Attached to AWS resources (e.g., S3 bucket policies).
    - Principal retains original permissions.
    - Use case: when a principal needs to access multiple accounts.
- Resource based policies are supported by many AWS services. S3, SQS, SNS, Lambda, ECR, etc.

## IAM Permission Boundaries

- Set maximum permissions for IAM users and roles.
- Do not apply to groups.
- Used to delegate limited administrative access.
- Intersection of SCP, Permission boundary and Identity based policies.
- Example:
    - Permission boundary: S3, CloudWatch, EC2.
    - IAM Policy: IAM create user.
    - Result: No permissions, because create user is not in the permission boundary.
- Useful for:
    - Delegating responsibilities to non-administrators.
    - Restricting specific users.

**IAM Permission Boundaries: Core Concepts**

- **Purpose:**
    - IAM permission boundaries are designed to set the maximum permissions that an IAM identity (user or role) can have.
    - They act as a guardrail, limiting the scope of permissions that can be granted through IAM policies.
    - Essentially, they define the upper limit of permissions.
- **Functionality:**
    - Permission boundaries do not grant permissions themselves. Instead, they restrict the permissions that can be granted by other IAM policies.
    - They are particularly useful for delegating IAM administration while maintaining control over potential privilege escalation.
- **Key Use Cases:**
    - **Delegating IAM Administration:**
        - Allowing developers or other users to create and manage IAM roles and policies within defined limits.
        - Preventing those users from granting themselves or others excessive privileges.
    - **Enhancing Security:**
        - Implementing an extra layer of security to prevent unintended or malicious privilege escalation.
        - Enforcing organizational security policies and compliance requirements.
    - **Controlling Third-Party Access:**
        - When granting third party vendors access, permission boundries can limit the access to only the needed resources.
- **How They Work:**
    - A permission boundary is an IAM policy that is attached to an IAM identity.
    - When AWS evaluates permissions, it considers both the identity-based policies and the permission boundary.
    - The effective permissions are the intersection of the permissions granted by the identity-based policies and the permissions allowed by the permission boundary.
- **Important distinctions:**
    - It is very important to understand that permission boundries are not the same as IAM policies, or Service Control policies. They work in tandem with each other to provide a robust security posture.

**Key Considerations:**

- Permission boundaries are a powerful tool for enhancing security and managing IAM permissions.
- Properly defining and implementing permission boundaries requires careful planning and consideration of your organization's security requirements.

I hope this information is helpful.