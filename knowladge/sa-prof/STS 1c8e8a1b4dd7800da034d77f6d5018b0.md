# STS

**AWS Security Token Service (STS): Key Concepts**

- **Purpose:**
    - Enables temporary security credentials for accessing AWS resources.
    - Facilitates cross-account access and identity federation.
- **Core Functionality:**
    - Uses IAM roles and the `AssumeRole` API to grant temporary credentials.
    - Temporary credentials expire after a defined duration (15 minutes to 12 hours).
- **Use Cases:**
    - Granting IAM users access to resources within the same or different AWS accounts.
    - Providing third-party access to AWS resources.
    - Enabling AWS services to perform actions using service roles.
    - Implementing identity federation (SAML, web identity).
- **Revoking STS Sessions:**
    - Revoke active sessions by modifying IAM policies with time conditions or using the `AWSRevokeOlderSessions` managed policy.
- **Role Assumption:**
    - When assuming a role, the principal temporarily relinquishes its original permissions and adopts the role's permissions.
    
    ![image.png](image%201.png)
    
- **Cross-Account Access (Within Your Accounts):**
    - Create IAM roles in the target account with necessary permissions.
    - Grant users in the source account permission to assume the role.
    - Benefits: Least privilege, auditing via CloudTrail, MFA support.
- **Cross-Account Access (Third-Party Accounts):**
    - **External ID:**
        - Crucial for preventing the "confused deputy" problem.
        - A shared secret between your account and the third-party account.
        - Ensures only the intended third party can assume the role.
    - **Confused Deputy Problem:**
        - Occurs when a third-party account is tricked into performing actions in your account.
        - External IDs prevent this by verifying the source of the role assumption.
- **Session Tags:**
    - Pass tags during `AssumeRole` calls.
    - Use `aws:PrincipalTag` conditions in IAM policies to control access based on session tags.
    - This is very useful for federated users.
- **Key STS APIs:**
    - `AssumeRole`: Basic role assumption.
    - `AssumeRoleWithSAML`: SAML federation.
    - `AssumeRoleWithWebIdentity`: Web identity federation (Cognito, etc.). AWS recommends Cognito.
    - `GetSessionToken`: MFA-based credentials.
    - `GetFederationToken`: Federation via proxy applications.

**Key Takeaways:**

- STS is essential for secure cross-account access and identity federation.
- External IDs are critical when granting third-party access.
- Session tags allow for fine grained access control.
- Understand the various STS APIs and their use cases.